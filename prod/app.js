!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=0)}({"/Y4+":function(e,t){e.exports=require("babel-runtime/core-js/promise")},0:function(e,t,r){e.exports=r("NHnr")},"68aj":function(e,t){e.exports=require("nodemailer")},"A+cQ":function(e,t){e.exports=require("shelljs/global")},"G4N/":function(e,t){e.exports=require("babel-runtime/regenerator")},IEbr:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r("zH1C"),u=n(i),o=r("G4N/"),a=n(o),s=r("ZrOi"),f=n(s),c=r("W7zC"),l=n(c),d=r("UT68"),p=n(d),h=r("hQNV"),v=n(h),b=r("QWuY"),y=n(b),g=function(){function e(t){(0,l.default)(this,e),this.config=t,this.init()}return(0,p.default)(e,[{key:"init",value:function(){function e(){return t.apply(this,arguments)}var t=(0,f.default)(a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.drivers={line:(0,v.default)(this.config.notifyDrivers.line),email:(0,y.default)(this.config.notifyDrivers.email)};case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"send",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,f.default)(a.default.mark(function e(t,r){var n,i,o,s,f,c,l;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,i=!1,o=void 0,e.prev=3,s=(0,u.default)(t.notify);case 5:if(n=(f=s.next()).done){e.next=16;break}if(c=f.value,l=this.drivers[c]){e.next=11;break}return log("Notify driver "+c+" config not found","red"),e.abrupt("return");case 11:return e.next=13,l.send(t.name,r);case 13:n=!0,e.next=5;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(3),i=!0,o=e.t0;case 22:e.prev=22,e.prev=23,!n&&s.return&&s.return();case 25:if(e.prev=25,!i){e.next=28;break}throw o;case 28:return e.finish(25);case 29:return e.finish(22);case 30:case"end":return e.stop()}},e,this,[[3,18,22,30],[23,,25,29]])}));return e}()}]),e}();t.default=function(e){return new g(e)}},Ki9U:function(e,t){e.exports=require("shelljs")},NHnr:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r("G4N/"),u=n(i),o=r("ZrOi"),a=n(o),s=r("W7zC"),f=n(s),c=r("UT68"),l=n(c),d=r("ry2S"),p=n(d),h=r("Zz1P"),v=n(h),b=r("vHs2");r("A+cQ");var y=r("nTu4"),g=r("s76y"),x=n(g),m=function(){function e(){var t=this;(0,f.default)(this,e),global.chalk=p.default,global.log=this.log,global.now=this.now,global.config=JSON.parse((0,b.readFileSync)("static/config.json","utf8")),this.config=config,this.runner=(0,x.default)(this.config),console.log(p.default.cyan("App start... \t "+now()));for(var r in this.config.jobs)!function(e){var r=t.config.jobs[e];new y.CronJob(r.schedule,function(){return t.startJob(e,r)}).start(),r.runAtStart&&t.startJob(e,r)}(r)}return(0,l.default)(e,[{key:"log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cyan";console.log(p.default[t+"Bright"](e)+p.default.whiteBright("\t at "+now()))}},{key:"now",value:function(){return(0,v.default)(new Date).format("YYYY-MM-DD HH:mm:ss")}},{key:"startJob",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,a.default)(u.default.mark(function e(t,r){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:log("[Cron Service] Runner execute "+r.name+" \t\tat "+now()),this.runner.execute(t,r);case 2:case"end":return e.stop()}},e,this)}));return e}()}]),e}();t.default=new m},OMN4:function(e,t){e.exports=require("axios")},QWuY:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r("zH1C"),u=n(i),o=r("/Y4+"),a=n(o),s=r("G4N/"),f=n(s),c=r("ZrOi"),l=n(c),d=r("ovEZ"),p=n(d),h=r("W7zC"),v=n(h),b=r("UT68"),y=n(b),g=r("rz71"),x=n(g),m=r("giEd"),k=n(m),w=r("otuk"),_=n(w),C=r("68aj"),j=n(C),M=function(e){function t(){return(0,v.default)(this,t),(0,x.default)(this,(t.__proto__||(0,p.default)(t)).apply(this,arguments))}return(0,k.default)(t,e),(0,y.default)(t,[{key:"send",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,l.default)(f.default.mark(function e(t,r){var n,i;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=j.default.createTransport({port:this.driverConfig.transporter.port,host:this.driverConfig.transporter.host,auth:{user:this.driverConfig.transporter.username,pass:this.driverConfig.transporter.password}}),i={from:this.driverConfig.send.from,to:this.driverConfig.send.to,subject:t,html:this._getContent(t,r)},e.next=4,this._setMail(n,i);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"_setMail",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,l.default)(f.default.mark(function e(t,r){return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new a.default(function(e,n){t.sendMail(r,function(t,r){if(t)return log(t,"red"),log("[Notify] Send mail fail","red"),n(t);log("[Notify] Send mail successfully","green"),e()})}));case 1:case"end":return e.stop()}},e,this)}));return e}()},{key:"_getContent",value:function(e,t){var r="<h1>"+e+"</h1><br><br>",n=!0,i=!1,o=void 0;try{for(var a,s=(0,u.default)(t);!(n=(a=s.next()).done);n=!0){var f=a.value;r+="<div><h3>"+f.description+"</h3></div><br>",r+="<div><strong>type</strong></div></div><div>"+f.type+"</div><br>",r+="<div><strong>command</strong></div></div><div>"+f.command+"</div><br>",r+="<div><strong>log</strong></div></div><div>"+this._nl2br(f.log)+"</div><br>",r+="<hr><br>"}}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}},{key:"_nl2br",value:function(e){return String(e).replace(/\n/g,"<br>")}}]),t}(_.default);t.default=function(e){return new M(e)}},UT68:function(e,t){e.exports=require("babel-runtime/helpers/createClass")},W7zC:function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},ZrOi:function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},Zz1P:function(e,t){e.exports=require("moment")},giEd:function(e,t){e.exports=require("babel-runtime/helpers/inherits")},hQNV:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r("G4N/"),u=n(i),o=r("zH1C"),a=n(o),s=r("ZrOi"),f=n(s),c=r("ovEZ"),l=n(c),d=r("W7zC"),p=n(d),h=r("UT68"),v=n(h),b=r("rz71"),y=n(b),g=r("giEd"),x=n(g),m=r("otuk"),k=n(m),w=function(e){function t(){return(0,p.default)(this,t),(0,y.default)(this,(t.__proto__||(0,l.default)(t)).apply(this,arguments))}return(0,x.default)(t,e),(0,v.default)(t,[{key:"send",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,f.default)(u.default.mark(function e(t,r){var n,i,o,s,f,c,l;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.token=this.driverConfig.token,n=!0,i=!1,o=void 0,e.prev=4,s=(0,a.default)(r);case 6:if(n=(f=s.next()).done){e.next=22;break}return c=f.value,e.prev=8,e.next=11,this.axios({url:"https://notify-api.line.me/api/notify",method:"post",headers:{Authorization:"Bearer "+this.token},params:{message:this._getContent(t,c)}});case 11:log("[Notify] Send line notify successfully","green"),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(8),l=e.t0.response,log("[Notify] Line notify error "+l.status,"red"),log(""+l.data,"red");case 19:n=!0,e.next=6;break;case 22:e.next=28;break;case 24:e.prev=24,e.t1=e.catch(4),i=!0,o=e.t1;case 28:e.prev=28,e.prev=29,!n&&s.return&&s.return();case 31:if(e.prev=31,!i){e.next=34;break}throw o;case 34:return e.finish(31);case 35:return e.finish(28);case 36:case"end":return e.stop()}},e,this,[[4,24,28,36],[8,14],[29,,31,35]])}));return e}()},{key:"_getContent",value:function(e,t){var r="\n"+e+" - "+t.description+" - "+t.type+"\n\n";return r+=""+t.log}}]),t}(k.default);t.default=function(e){return new w(e)}},nTu4:function(e,t){e.exports=require("cron")},otuk:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r("G4N/"),u=n(i),o=r("ZrOi"),a=n(o),s=r("W7zC"),f=n(s),c=r("UT68"),l=n(c),d=r("OMN4"),p=n(d),h=function(){function e(t){(0,f.default)(this,e),this.config=config,this.driverConfig=t,this.axios=p.default,this.init()}return(0,l.default)(e,[{key:"init",value:function(){}},{key:"send",value:function(){function e(){return t.apply(this,arguments)}var t=(0,a.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)}));return e}()}]),e}();t.default=h},ovEZ:function(e,t){e.exports=require("babel-runtime/core-js/object/get-prototype-of")},ry2S:function(e,t){e.exports=require("chalk")},rz71:function(e,t){e.exports=require("babel-runtime/helpers/possibleConstructorReturn")},s76y:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r("/Y4+"),u=n(i),o=r("G4N/"),a=n(o),s=r("zH1C"),f=n(s),c=r("ZrOi"),l=n(c),d=r("W7zC"),p=n(d),h=r("UT68"),v=n(h),b=r("Ki9U"),y=n(b),g=r("IEbr"),x=n(g),m=function(){function e(t){(0,p.default)(this,e),this.config=t,this.notify=(0,x.default)(t),this.onProcess={},this.result=[]}return(0,v.default)(e,[{key:"execute",value:function(){function e(e,r){return t.apply(this,arguments)}var t=(0,l.default)(a.default.mark(function e(t,r){var n,i,u,o,s,c,l,d;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.onProcess[t]){e.next=3;break}return log("Skip job ["+r.name+"], cuz it's still process. \t\tat "+now(),"red"),e.abrupt("return");case 3:if(this.onProcess[t]=!0,Array.isArray(r.commands)){e.next=7;break}return log("commands property in config.js must be array type","red"),e.abrupt("return");case 7:n=!0,i=!1,u=void 0,e.prev=10,o=(0,f.default)(r.commands);case 12:if(n=(s=o.next()).done){e.next=27;break}return c=s.value,l={async:!0},c.cwd&&(l.cwd=c.cwd),c.description&&log("[Running] "+c.description),e.next=19,this._execAsync(""+c.command,l);case 19:d=e.sent,d.cwd=c.cwd,d.command=c.command,d.description=c.description,this.result.push(d);case 24:n=!0,e.next=12;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(10),i=!0,u=e.t0;case 33:e.prev=33,e.prev=34,!n&&o.return&&o.return();case 36:if(e.prev=36,!i){e.next=39;break}throw u;case 39:return e.finish(36);case 40:return e.finish(33);case 41:this.notify.send(r,this.result),this.result=[],delete this.onProcess[t];case 44:case"end":return e.stop()}},e,this,[[10,29,33,41],[34,,36,40]])}));return e}()},{key:"_execAsync",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new u.default(function(n,i){y.default.exec(e,r,function(){var e=(0,l.default)(a.default.mark(function e(r,u,o){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0==r){e.next=3;break}return log(o,"red"),e.abrupt("return",i({type:"error",log:o}));case 3:return e.abrupt("return",n({type:"success",log:u}));case 4:case"end":return e.stop()}},e,t)}));return function(t,r,n){return e.apply(this,arguments)}}())})}}]),e}();t.default=function(e){return new m(e)}},vHs2:function(e,t){e.exports=require("fs")},zH1C:function(e,t){e.exports=require("babel-runtime/core-js/get-iterator")}})});
//# sourceMappingURL=app.js.map